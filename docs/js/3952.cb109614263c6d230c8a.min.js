"use strict";(self.webpackChunkimtoken_dapp=self.webpackChunkimtoken_dapp||[]).push([[3952],{93952:(t,e,r)=>{var a=r(84390).errors,n=r(84390).formatters,o=r(18269),i=r(4017),s=r(96602).subscriptions,c=r(8286),u=function(t){if(!t.call||!t.name)throw new Error('When creating a method you need to provide at least the "name" and "call" property.');this.name=t.name,this.call=t.call,this.params=t.params||0,this.inputFormatter=t.inputFormatter,this.outputFormatter=t.outputFormatter,this.transformPayload=t.transformPayload,this.extraFormatters=t.extraFormatters,this.abiCoder=t.abiCoder,this.requestManager=t.requestManager,this.accounts=t.accounts,this.defaultBlock=t.defaultBlock||"latest",this.defaultAccount=t.defaultAccount||null,this.transactionBlockTimeout=t.transactionBlockTimeout||50,this.transactionConfirmationBlocks=t.transactionConfirmationBlocks||24,this.transactionPollingTimeout=t.transactionPollingTimeout||750,this.defaultCommon=t.defaultCommon,this.defaultChain=t.defaultChain,this.defaultHardfork=t.defaultHardfork,this.handleRevert=t.handleRevert};u.prototype.setRequestManager=function(t,e){this.requestManager=t,e&&(this.accounts=e)},u.prototype.createFunction=function(t,e){var r=this.buildCall();return r.call=this.call,this.setRequestManager(t||this.requestManager,e||this.accounts),r},u.prototype.attachToObject=function(t){var e=this.buildCall();e.call=this.call;var r=this.name.split(".");r.length>1?(t[r[0]]=t[r[0]]||{},t[r[0]][r[1]]=e):t[r[0]]=e},u.prototype.getCall=function(t){return"function"==typeof this.call?this.call(t):this.call},u.prototype.extractCallback=function(t){if("function"==typeof t[t.length-1])return t.pop()},u.prototype.validateArgs=function(t){if(t.length!==this.params)throw a.InvalidNumberOfParams(t.length,this.params,this.name)},u.prototype.formatInput=function(t){var e=this;return this.inputFormatter?this.inputFormatter.map((function(r,a){return r?r.call(e,t[a]):t[a]})):t},u.prototype.formatOutput=function(t){var e=this;return Array.isArray(t)?t.map((function(t){return e.outputFormatter&&t?e.outputFormatter(t):t})):this.outputFormatter&&t?this.outputFormatter(t):t},u.prototype.toPayload=function(t){var e=this.getCall(t),r=this.extractCallback(t),a=this.formatInput(t);this.validateArgs(a);var n={method:e,params:a,callback:r};return this.transformPayload&&(n=this.transformPayload(n)),n},u.prototype._confirmTransaction=function(t,e,r){var l=this,m=!1,p=!0,h=0,f=0,d=null,v=null,g=r.params[0]&&"object"==typeof r.params[0]&&r.params[0].gas?r.params[0].gas:null,b=!!r.params[0]&&"object"==typeof r.params[0]&&r.params[0].data&&r.params[0].from&&!r.params[0].to,y=b&&r.params[0].data.length>2,F=[new u({name:"getBlockByNumber",call:"eth_getBlockByNumber",params:2,inputFormatter:[n.inputBlockNumberFormatter,function(t){return!!t}],outputFormatter:n.outputBlockFormatter}),new u({name:"getTransactionReceipt",call:"eth_getTransactionReceipt",params:1,inputFormatter:[null],outputFormatter:n.outputTransactionReceiptFormatter}),new u({name:"getCode",call:"eth_getCode",params:2,inputFormatter:[n.inputAddressFormatter,n.inputDefaultBlockNumberFormatter]}),new u({name:"getTransactionByHash",call:"eth_getTransactionByHash",params:1,inputFormatter:[null],outputFormatter:n.outputTransactionFormatter}),new s({name:"subscribe",type:"eth",subscriptions:{newBlockHeaders:{subscriptionName:"newHeads",params:0,outputFormatter:n.outputBlockFormatter}}})],E={};F.forEach((t=>{t.attachToObject(E),t.requestManager=l.requestManager}));var k=function(s,u,F,k,P){if(!F)return P||(P={unsubscribe:function(){clearInterval(d)}}),(s?i.resolve(s):E.getTransactionReceipt(e)).catch((function(e){P.unsubscribe(),m=!0,o._fireError({message:"Failed to check for transaction receipt:",data:e},t.eventEmitter,t.reject)})).then((async function(e){if(!e||!e.blockHash)throw new Error("Receipt missing or blockHash null");if(l.extraFormatters&&l.extraFormatters.receiptFormatter&&(e=l.extraFormatters.receiptFormatter(e)),t.eventEmitter.listeners("confirmation").length>0){var r;if(void 0===s||0!==f){var a=await E.getBlockByNumber("latest"),n=a?a.hash:null;u?v?(r=await E.getBlockByNumber(v.number+1))&&(v=r,t.eventEmitter.emit("confirmation",f,e,n)):(r=await E.getBlockByNumber(e.blockNumber),v=r,t.eventEmitter.emit("confirmation",f,e,n)):t.eventEmitter.emit("confirmation",f,e,n)}(u&&r||!u)&&f++,p=!1,f===l.transactionConfirmationBlocks+1&&(P.unsubscribe(),t.eventEmitter.removeAllListeners())}return e})).then((async function(e){if(b&&!m){if(!e.contractAddress)return p&&(P.unsubscribe(),m=!0),void o._fireError(a.NoContractAddressFoundError(e),t.eventEmitter,t.reject,null,e);var r;try{r=await E.getCode(e.contractAddress)}catch(t){}if(!r)return;!0===e.status&&y||r.length>2?(t.eventEmitter.emit("receipt",e),l.extraFormatters&&l.extraFormatters.contractDeployFormatter?t.resolve(l.extraFormatters.contractDeployFormatter(e)):t.resolve(e),p&&t.eventEmitter.removeAllListeners()):o._fireError(a.ContractCodeNotStoredError(e),t.eventEmitter,t.reject,null,e),p&&P.unsubscribe(),m=!0}return e})).then((async function(e){if(!b&&!m){if(e.outOfGas||g&&g===e.gasUsed||!0!==e.status&&"0x1"!==e.status&&void 0!==e.status)if(JSON.stringify(e,null,2),!1===e.status||"0x0"===e.status)try{var i=null;if(!l.handleRevert||"eth_sendTransaction"!==l.call&&"eth_sendRawTransaction"!==l.call)throw!1;var s=r.params[0];if("eth_sendRawTransaction"===l.call){var u=r.params[0],h=c.parse(u);s=n.inputTransactionFormatter({data:h.data,to:h.to,from:h.from,gas:h.gasLimit.toHexString(),gasPrice:h.gasPrice.toHexString(),value:h.value.toHexString()})}if(!(i=await l.getRevertReason(s,e.blockNumber)))throw!1;o._fireError(a.TransactionRevertInstructionError(i.reason,i.signature,e),t.eventEmitter,t.reject,null,e)}catch(r){o._fireError(a.TransactionRevertedWithoutReasonError(e),t.eventEmitter,t.reject,null,e)}else o._fireError(a.TransactionOutOfGasError(e),t.eventEmitter,t.reject,null,e);else t.eventEmitter.emit("receipt",e),t.resolve(e),p&&t.eventEmitter.removeAllListeners();p&&P.unsubscribe(),m=!0}})).catch((function(){h++,u?h-1>=l.transactionPollingTimeout&&(P.unsubscribe(),m=!0,o._fireError(a.TransactionError("Transaction was not mined within "+l.transactionPollingTimeout+" seconds, please make sure your transaction was properly sent. Be aware that it might still be mined!"),t.eventEmitter,t.reject)):h-1>=l.transactionBlockTimeout&&(P.unsubscribe(),m=!0,o._fireError(a.TransactionError("Transaction was not mined within "+l.transactionBlockTimeout+" blocks, please make sure your transaction was properly sent. Be aware that it might still be mined!"),t.eventEmitter,t.reject))}));P.unsubscribe(),m=!0,o._fireError({message:"Failed to subscribe to new newBlockHeaders to confirm the transaction receipts.",data:F},t.eventEmitter,t.reject)},P=function(t){const e=()=>{d=setInterval(k.bind(null,t,!0),1e3)};this.requestManager.provider.on?E.subscribe("newBlockHeaders",(function(r,a,n){r||!a?e():k(t,!1,r,0,n)})):e()}.bind(this);E.getTransactionReceipt(e).then((function(e){e&&e.blockHash?(t.eventEmitter.listeners("confirmation").length>0&&P(e),k(e,!1)):m||P()})).catch((function(){m||P()}))};var l=function(t,e){return"number"==typeof t?e.wallet[t]:t&&"object"==typeof t&&t.address&&t.privateKey?t:e.wallet[t.toLowerCase()]};function m(t,e){return new Promise(((r,a)=>{try{var n=new u({name:"getBlockByNumber",call:"eth_getBlockByNumber",params:2,inputFormatter:[function(t){return t?o.toHex(t):"latest"},function(){return!1}]}).createFunction(t.requestManager),i=new u({name:"getGasPrice",call:"eth_gasPrice",params:0}).createFunction(t.requestManager);Promise.all([n(),i()]).then((t=>{const[a,n]=t;if(("0x2"===e.type||void 0===e.type)&&a&&a.baseFeePerGas){let t,n;e.gasPrice?(t=e.gasPrice,n=e.gasPrice,delete e.gasPrice):(t=e.maxPriorityFeePerGas||"0x9502F900",n=e.maxFeePerGas||o.toHex(o.toBN(a.baseFeePerGas).mul(o.toBN(2)).add(o.toBN(t)))),r({maxFeePerGas:n,maxPriorityFeePerGas:t})}else{if(e.maxPriorityFeePerGas||e.maxFeePerGas)throw Error("Network doesn't support eip-1559");r({gasPrice:n})}}))}catch(t){a(t)}}))}u.prototype.buildCall=function(){var t=this,e="eth_sendTransaction"===t.call||"eth_sendRawTransaction"===t.call,r="eth_call"===t.call,n=function(){var n=i(!e),s=t.toPayload(Array.prototype.slice.call(arguments)),c=function(i,c){var u;if(t.handleRevert&&r&&t.abiCoder&&(!i&&t.isRevertReasonString(c)?u=c.substring(10):i&&i.data&&(u=i.data.substring(10)),u)){var l=t.abiCoder.decodeParameter("string","0x"+u),m="Error(String)";return void o._fireError(a.RevertInstructionError(l,m),n.eventEmitter,n.reject,s.callback,{reason:l,signature:m})}try{c=t.formatOutput(c)}catch(t){i=t}if(c instanceof Error&&(i=c),i)return i.error&&(i=i.error),o._fireError(i,n.eventEmitter,n.reject,s.callback);s.callback&&s.callback(null,c),e?(n.eventEmitter.emit("transactionHash",c),t._confirmTransaction(n,c,s)):i||n.resolve(c)},u=function(e){var r={...s,method:"eth_sendRawTransaction",params:[e.rawTransaction]};t.requestManager.send(r,c)},p=function(t,e){var r;if(e&&e.accounts&&e.accounts.wallet&&e.accounts.wallet.length)if("eth_sendTransaction"===t.method){var a=t.params[0];if((r=l(a&&"object"==typeof a?a.from:null,e.accounts))&&r.privateKey)return delete(a=JSON.parse(JSON.stringify(a))).from,e.defaultChain&&!a.chain&&(a.chain=e.defaultChain),e.defaultHardfork&&!a.hardfork&&(a.hardfork=e.defaultHardfork),e.defaultCommon&&!a.common&&(a.common=e.defaultCommon),void e.accounts.signTransaction(a,r.privateKey).then(u).catch((function(t){if("function"==typeof n.eventEmitter.listeners&&n.eventEmitter.listeners("error").length){try{n.eventEmitter.emit("error",t)}catch(t){}n.eventEmitter.removeAllListeners(),n.eventEmitter.catch((function(){}))}n.reject(t)}))}else if("eth_sign"===t.method){var o=t.params[1];if((r=l(t.params[0],e.accounts))&&r.privateKey){var i=e.accounts.sign(o,r.privateKey);return t.callback&&t.callback(null,i.signature),void n.resolve(i.signature)}}return e.requestManager.send(t,c)};return e&&s.params[0]&&"object"==typeof s.params[0]&&void 0===s.params[0].gasPrice&&(void 0===s.params[0].maxPriorityFeePerGas||void 0===s.params[0].maxFeePerGas)?m(t,s.params[0]).then((r=>{void 0!==r.gasPrice?s.params[0].gasPrice=r.gasPrice:void 0!==r.maxPriorityFeePerGas&&void 0!==r.maxFeePerGas&&(s.params[0].maxPriorityFeePerGas=r.maxPriorityFeePerGas,s.params[0].maxFeePerGas=r.maxFeePerGas),e&&setTimeout((()=>{n.eventEmitter.emit("sending",s)}),0),p(s,t)})):(e&&setTimeout((()=>{n.eventEmitter.emit("sending",s)}),0),p(s,t)),e&&setTimeout((()=>{n.eventEmitter.emit("sent",s)}),0),n.eventEmitter};return n.method=t,n.request=this.request.bind(this),n},u.prototype.getRevertReason=function(t,e){var r=this;return new Promise((function(a,n){new u({name:"call",call:"eth_call",params:2,abiCoder:r.abiCoder,handleRevert:!0}).createFunction(r.requestManager)(t,o.numberToHex(e)).then((function(){a(!1)})).catch((function(t){t.reason?a({reason:t.reason,signature:t.signature}):n(t)}))}))},u.prototype.isRevertReasonString=function(t){return"string"==typeof t&&(t.length-2)/2%32==4&&"0x08c379a0"===t.substring(0,10)},u.prototype.request=function(){var t=this.toPayload(Array.prototype.slice.call(arguments));return t.format=this.formatOutput.bind(this),t},t.exports=u}}]);